<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Sorteos Pro Venezuela — Premio Octubre Feliz</title>
  <meta name="description" content="Participa en Sorteos Pro Venezuela. Premio Octubre Feliz: 10.000$. Fecha: 25 de octubre de 2025." />
  <style>
    :root{
      --bg:#0f1220; --card:#11162a; --muted:#9aa3b2; --text:#e9edf2; --brand:#6ee7b7; --brand-2:#22d3ee; --danger:#ef4444; --ok:#22c55e;
      --radius:14px; --radius-sm:10px; --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1200px 800px at 70% -10%, #1b2342 0%, #0f1220 55%), var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
    a{color:inherit}
    .wrap{max-width:960px;margin-inline:auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand-2))}
    .title{font-weight:700;font-size:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow)}
    .hero{padding:22px;border-radius:var(--radius);display:grid;gap:16px}
    .hero h1{font-size:28px;line-height:1.15;margin:0}
    .hero p{margin:0;color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.row{grid-template-columns:1fr 1fr}}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:100px;background:rgba(255,255,255,.06);color:#d9ffef;border:1px solid rgba(110,231,183,.35)}
    .muted{color:var(--muted)}
    .btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 18px;border-radius:12px;border:1px solid transparent;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#0b1220;font-weight:700}
    .btn.secondary{background:transparent;border-color:rgba(255,255,255,.12);color:var(--text)}
    .btn.full{width:100%}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .stepper{display:flex;gap:12px;flex-wrap:wrap}
    .step{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:100px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03)}
    .step.active{border-color:rgba(110,231,183,.5);background:rgba(110,231,183,.07)}
    .copy{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.12);cursor:pointer}
    .grid{display:grid;gap:12px}
    .payline{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px dashed rgba(255,255,255,.18);border-radius:12px;padding:10px}
    label{display:block;margin:6px 0 6px 4px;color:#cfd6e3;font-size:14px}
    input,select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
    input::placeholder,textarea::placeholder{color:#a7b0c0}
    .section{padding:16px}
    .hidden{display:none}
    .success{display:grid;place-items:center;text-align:center;gap:14px;padding:22px}
    .numbers{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
    .num{padding:8px 10px;border-radius:8px;background:#0c182c;border:1px solid rgba(255,255,255,.12)}
    .warn{padding:12px;border-radius:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);color:#c9e4ff}
    footer{margin:36px 0 24px;color:var(--muted);font-size:13px}
    .mini{font-size:12px;color:#b7bfd0}
    .toast{position:fixed;inset:auto 16px 16px auto;background:#1e293b;color:#fff;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);opacity:0;transform:translateY(10px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
    canvas#confetti{position:fixed;inset:0;pointer-events:none}
  </style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">Sorteos Pro Venezuela</div>
        <div class="mini">Premio Octubre Feliz · Sortea el 25/oct/2025</div>
      </div>
    </div>
    <button class="btn" id="btnParticiparTop">Participar</button>
  </header>

  <section class="hero card">
    <div class="row">
      <div>
        <h1>Premio Octubre Feliz: <span class="pill">$10.000</span></h1>
        <p class="muted">Fecha del sorteo: <strong>25 de octubre de 2025</strong>.</p>
        <p class="muted">Boletos disponibles: <strong>10.000</strong>. Entrega <strong>aleatoria</strong> al reportar tu pago móvil.</p>
        <div class="stepper" style="margin-top:10px">
          <div class="step active" id="s1"><b>1</b> Datos</div>
          <div class="step" id="s2"><b>2</b> Pago móvil</div>
          <div class="step" id="s3"><b>3</b> Captura & envío</div>
        </div>
        <div style="margin-top:12px"><button class="btn" id="btnParticipar">Participar ahora</button></div>
      </div>
      <div class="section">
        <div class="warn">
          <b>Importante:</b> luego de pagar, <u>sube tu captura</u>, deja tus datos y recibirás tus números <b>al azar</b>. Te mostraremos un comprobante para que <b>tomes captura</b>.
        </div>
      </div>
    </div>
  </section>

  <!-- Paso 1: Datos del participante -->
  <section class="card section" id="step1">
    <h2 style="margin:0 0 8px">1) Tus datos</h2>
    <div class="grid">
      <div>
        <label>Nombre y apellido</label>
        <input id="fullName" placeholder="Ej: María Pérez" autocomplete="name" required />
      </div>
      <div class="row">
        <div>
          <label>Tipo de documento</label>
          <select id="docType">
            <option>V</option><option>E</option><option>J</option><option>P</option><option>G</option>
          </select>
        </div>
        <div>
          <label>Número de documento</label>
          <input id="docNumber" inputmode="numeric" placeholder="Ej: 12345678" required />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Teléfono</label>
          <input id="phone" inputmode="tel" placeholder="Ej: 0412-1234567" required />
        </div>
        <div>
          <label>Correo electrónico</label>
          <input id="email" type="email" placeholder="tu@correo.com" required />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Cantidad de números a comprar</label>
          <input id="qty" type="number" min="1" max="100" value="1" required />
        </div>
        <div class="mini" style="align-self:end">Los números se asignan de <b>forma aleatoria</b> de un conjunto de 10.000.</div>
      </div>
      <div><button class="btn full" id="goStep2">Continuar</button></div>
    </div>
  </section>

  <!-- Paso 2: Pago móvil -->
  <section class="card section hidden" id="step2">
    <h2 style="margin:0 0 8px">2) Realiza el pago móvil</h2>
    <p class="muted">Copia estos datos en tu banco, realiza el pago y pasa al siguiente paso para reportarlo.</p>
    <div class="grid">
      <div class="payline"><div><b>Banco</b><br>Provincial (0108)</div><button class="copy" data-copy="Provincial (0108)">Copiar</button></div>
      <div class="payline"><div><b>RIF/Cédula</b><br>15.857.050</div><button class="copy" data-copy="15857050">Copiar</button></div>
      <div class="payline"><div><b>Teléfono</b><br>0424-4150022</div><button class="copy" data-copy="04244150022">Copiar</button></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn secondary" id="back1">Volver</button>
      <button class="btn" id="goStep3">Ya pagué, reportar</button>
    </div>
    <p class="mini" style="margin-top:8px">Tip: muchas plataformas piden el <b>número de referencia (6 dígitos)</b>. Aquí te lo pediremos en el siguiente paso. </p>
  </section>

  <!-- Paso 3: Reporte + Captura -->
  <section class="card section hidden" id="step3">
    <h2 style="margin:0 0 8px">3) Sube tu captura y datos del pago</h2>
    <div class="grid">
      <div class="row">
        <div>
          <label>Monto pagado (Bs. o $)</label>
          <input id="amount" inputmode="decimal" placeholder="Ej: 479,00" required />
        </div>
        <div>
          <label>Número de referencia (6 dígitos)</label>
          <input id="ref6" inputmode="numeric" maxlength="6" placeholder="Ej: 123456" required />
        </div>
      </div>
      <div>
        <label>Banco emisor (desde el que pagaste)</label>
        <select id="bankEmitter">
          <option>(0108) BBVA PROVINCIAL</option>
          <option>(0102) BANCO DE VENEZUELA</option>
          <option>(0105) MERCANTIL</option>
          <option>(0191) BNC</option>
          <option>(0134) BANESCO</option>
          <option>(0114) BANCARIBE</option>
          <option>(0172) BANCAMIGA</option>
          <option>(0163) BANCO DEL TESORO</option>
          <option>Otro</option>
        </select>
      </div>
      <div class="row">
        <div>
          <label>Documento del pagador</label>
          <div class="row">
            <select id="payerDocType">
              <option>V</option><option>E</option><option>J</option><option>P</option><option>G</option>
            </select>
            <input id="payerDocNumber" inputmode="numeric" placeholder="N° documento" />
          </div>
        </div>
        <div>
          <label>Teléfono del pagador</label>
          <input id="payerPhone" inputmode="tel" placeholder="Ej: 0414-0000000" />
        </div>
      </div>
      <div>
        <label>Fecha/Hora del pago</label>
        <input id="paidAt" type="datetime-local" />
      </div>
      <div>
        <label>Sube la <b>captura del pago</b></label>
        <input id="receipt" type="file" accept="image/*,application/pdf" required />
        <p class="mini">Acepta imagen o PDF. Ideal: captura nítida donde se vea el monto, referencia y fecha.</p>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn secondary" id="back2">Volver</button>
        <button class="btn" id="submitAll">Enviar y obtener mis números</button>
      </div>
      <div id="status" class="mini"></div>
    </div>
  </section>

  <!-- Éxito -->
  <section class="card section hidden" id="success">
    <div class="success">
      <h2>🎉 ¡Compra registrada!</h2>
      <p>Te asignamos <b>tus números</b> de forma aleatoria.<br>✨ <b>Toma captura</b> de esta pantalla para conservarla.</p>
      <div id="assignedBox" class="numbers"></div>
      <div class="warn">También enviamos un aviso a <b>sorteosprovenezuela@gmail.com</b> para revisión. Una vez <b>aprobada</b>, tus números quedan fijos. Si se <b>rechaza</b>, se liberan y pueden reasignarse.</div>
      <button class="btn" id="copyReceipt">Copiar comprobante</button>
      <a class="btn secondary" href="#" onclick="location.reload()">Ir al inicio</a>
    </div>
  </section>

  <footer class="wrap">
    <div class="mini">Sorteos Pro Venezuela — Premio Octubre Feliz: $10.000 — Sorteo: 25/oct/2025</div>
    <div class="mini">Al participar aceptas Términos y Política de Privacidad. Conserva tu captura.</div>
  </footer>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">Copiado</div>

<script>
  // === CONFIG ===
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyw1eIHuZESpAnQVoWQeFXI2JKPDUXhlUPSxSuxurEys9zQirbT5PmLu8WcyTiDxVGFQA/exec";

  // === UI helpers ===
  const $ = s => document.querySelector(s);
  const show = (id) => document.getElementById(id).classList.remove('hidden');
  const hide = (id) => document.getElementById(id).classList.add('hidden');
  const toast = (msg="Copiado") => { const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1500); };
  const setActive = (n)=>{ ["s1","s2","s3"].forEach((id,i)=>document.getElementById(id).classList.toggle("active", i===n-1)); };

  // === Navegación pasos ===
  $("#btnParticipar").onclick = $("#btnParticiparTop").onclick = ()=>{ window.scrollTo({top:document.body.offsetTop,behavior:"smooth"}); };
  $("#goStep2").onclick = () => { hide("step1"); show("step2"); setActive(2); window.scrollTo({top:0,behavior:"smooth"}); };
  $("#back1").onclick  = () => { hide("step2"); show("step1"); setActive(1); };
  $("#goStep3").onclick = () => { hide("step2"); show("step3"); setActive(3); window.scrollTo({top:0,behavior:"smooth"}); };
  $("#back2").onclick  = () => { hide("step3"); show("step2"); setActive(2); };

  // === Copiar datos de pago ===
  document.querySelectorAll(".copy").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      try{ await navigator.clipboard.writeText(btn.dataset.copy); toast("Copiado"); }catch(e){ toast("No se pudo copiar"); }
    });
  });

  // === Envío final ===
  $("#submitAll").onclick = async ()=>{
    const fullName = $("#fullName").value.trim();
    const docType = $("#docType").value;
    const docNumber = $("#docNumber").value.trim();
    const phone = $("#phone").value.trim();
    const email = $("#email").value.trim();
    const qty = Math.min(Math.max(parseInt($("#qty").value||"1",10),1),100);

    const amount = $("#amount").value.trim();
    const ref6 = $("#ref6").value.trim();
    const bankEmitter = $("#bankEmitter").value;
    const payerDocType = $("#payerDocType").value;
    const payerDocNumber = $("#payerDocNumber").value.trim();
    const payerPhone = $("#payerPhone").value.trim();
    const paidAt = $("#paidAt").value;
    const file = $("#receipt").files[0];

    if(!fullName || !docNumber || !phone || !email || !amount || !ref6 || !file){
      $("#status").textContent = "Por favor completa los campos requeridos.";
      return;
    }

    $("#submitAll").disabled = true;
    $("#status").textContent = "Subiendo captura y registrando compra…";

    try{
      const file64 = await fileToBase64(file); // data URL
      const payload = {
        action:"submitPurchase",
        participant:{fullName, docType, docNumber, phone, email},
        quantity: qty,
        payment:{ amount, ref6, bankEmitter, payerDocType, payerDocNumber, payerPhone, paidAt },
        file:{ fileName:file.name, mimeType:file.type, base64:file64 },
        meta:{ userAgent:navigator.userAgent }
      };

      const body = "payload=" + encodeURIComponent(JSON.stringify(payload));
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/x-www-form-urlencoded" },
        body
      });
      const json = await res.json();

      if(!json.ok){ throw new Error(json.error || "Error de servidor"); }

      // Mostrar éxito
      const assigned = json.assignedNumbers || [];
      const box = $("#assignedBox"); box.innerHTML = "";
      assigned.forEach(n=>{
        const span = document.createElement("span"); span.className="num"; span.textContent = ("00000"+n).slice(-5);
        box.appendChild(span);
      });

      const receiptText = [
        "Sorteos Pro Venezuela — Compra registrada",
        "Participante: " + fullName + " — CI: " + docType + "-" + docNumber,
        "Tel: " + phone + " — Email: " + email,
        "Cantidad: " + qty + " — Números: " + assigned.join(", "),
        "Pago: " + amount + " — Ref: " + ref6 + " — Banco emisor: " + bankEmitter,
        "Fecha pago: " + (paidAt||""),
        "ID de compra: " + (json.purchaseId||"")
      ].join("\n");

      $("#copyReceipt").onclick = async ()=>{ try{ await navigator.clipboard.writeText(receiptText); toast("Comprobante copiado"); }catch{} };

      hide("step3"); show("success"); setActive(3);
      confetti();
      window.scrollTo({top:0,behavior:"smooth"});

    }catch(err){
      console.error(err);
      $("#status").textContent = "Hubo un problema: " + err.message;
      $("#submitAll").disabled = false;
    }
  };

  function fileToBase64(file){
    return new Promise((resolve,reject)=>{
      const r = new FileReader();
      r.onload = ()=> resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  // === Mini confeti ===
  function confetti(){
    const cvs = document.getElementById("confetti"), ctx = cvs.getContext("2d");
    const W = cvs.width = window.innerWidth, H = cvs.height = window.innerHeight;
    const P = Array.from({length:120},()=>({
      x:Math.random()*W,y:Math.random()*-H, r:2+Math.random()*4, vy:2+Math.random()*3, vx:(Math.random()-.5)*1.5, a:Math.random()*Math.PI
    }));
    let t=0; const loop=()=>{
      ctx.clearRect(0,0,W,H);
      P.forEach(p=>{
        p.y+=p.vy; p.x+=p.vx; p.a+=.1; if(p.y>H){p.y=-10; p.x=Math.random()*W;}
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
        ctx.fillStyle = `hsl(${(p.x+p.y+t)%360} 90% 60%)`;
        ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
        ctx.restore();
      });
      t+=1; if(t<550) requestAnimationFrame(loop); else ctx.clearRect(0,0,W,H);
    }; loop();
  }
</script>
</body>
</html>
